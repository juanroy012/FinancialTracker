{% extends "base.html" %}

{% block title %}{{ title or "Add Category" }}{% endblock %}

{% block content %}
<h1>{{ title or "Add Category" }}</h1>

{% if messages %}
  <ul class="flashes">
    {% for msg in messages %}
      <li class="error">{{ msg }}</li>
    {% endfor %}
  </ul>
{% endif %}

<div id="form-message" class="form-message" aria-live="polite"></div>

{# Simple form - CategoryCreate schema only has 'name' field
   Why categories: Organize transactions (e.g., Food, Rent, Salary, Entertainment)
   DB enforces UNIQUE constraint on name - duplicate names will fail
#}
<form id="category-form" method="post" action="/category">
  <label for="name">Category Name *
    <small>A short descriptive name for grouping similar transactions</small>
  </label>
  <input 
    id="name" 
    name="name" 
    type="text" 
    placeholder="e.g., Groceries, Salary, Rent"
    maxlength="100"
    value="{{ form_data.name if form_data else '' }}" 
    required>
  
  <div class="form-actions">
    <button type="submit" class="btn-primary">âœ… Create Category</button>
    <a href="/category" class="btn btn-secondary">Cancel</a>
  </div>
</form>

<div class="help-box">
  <h3>ðŸ’¡ Category Tips</h3>
  <ul>
    <li><strong>Keep names short:</strong> "Food" instead of "Food and Groceries"</li>
    <li><strong>Be consistent:</strong> Use singular or plural, not both</li>
    <li><strong>Common examples:</strong> Housing, Transportation, Entertainment, Healthcare, Income</li>
    <li><strong>Unique names:</strong> Each category name must be different</li>
  </ul>
</div>

<style>
  label small {
    display: block;
    font-weight: normal;
    color: #6c757d;
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }
  
  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
  }

  .form-message {
    margin: 1rem 0;
    padding: 0.75rem 1rem;
    border-radius: 4px;
    background: #f1f3f5;
    color: #495057;
    display: none;
  }

  .form-message.success {
    display: block;
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .form-message.error {
    display: block;
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  
  /* Help box with tips
     Why: Guides users on best practices */
  .help-box {
    margin-top: 2rem;
    padding: 1.5rem;
    background: #e7f3ff;
    border-left: 4px solid #2196F3;
    border-radius: 4px;
    max-width: 600px;
  }
  
  .help-box h3 {
    margin-bottom: 1rem;
    color: #1976d2;
  }
  
  .help-box ul {
    margin-left: 1.5rem;
  }
  
  .help-box li {
    margin-bottom: 0.5rem;
  }
  
  input::placeholder {
    color: #adb5bd;
  }
</style>

<script>
  const form = document.getElementById("category-form");
  const message = document.getElementById("form-message");
  const nameInput = document.getElementById("name");

  form.addEventListener("submit", async (event) => {
    event.preventDefault();
    message.textContent = "";
    message.className = "form-message";

    const name = nameInput.value.trim();
    if (!name) {
      message.textContent = "Name is required.";
      message.className = "form-message error";
      return;
    }

    const response = await fetch("/category/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name })
    });

    if (!response.ok) {
      const errorText = await response.text();
      message.textContent = errorText || "Failed to create category.";
      message.className = "form-message error";
      return;
    }

    message.textContent = "Category created.";
    message.className = "form-message success";
    form.reset();
    nameInput.focus();
  });
</script>

{% endblock %}
